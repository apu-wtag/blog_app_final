<div data-controller="comments">
  <%= turbo_frame_tag comment do %>
    <div class="bg-gray-50 border border-gray-200 rounded-xl p-4 shadow-sm">

      <!-- Header with Avatar + Name + Time -->
      <div class="flex items-center space-x-3">
        <div class="h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center font-bold text-gray-700">
          <%= comment.user.name.to_s.chr.upcase %>
        </div>
        <div>
          <p class="font-semibold text-gray-900"><%= comment.user.name %></p>
          <span class="text-xs text-gray-500"><%= time_ago_in_words(comment.created_at) %> ago</span>
        </div>
      </div>

      <!-- Body -->
      <div class="mt-3 text-gray-800 leading-relaxed">
        <%= comment.body %>
      </div>

      <!-- Actions (Reply / Edit / Delete / View replies) -->
      <div class="mt-3 ml-12 text-xs text-gray-500 flex items-center space-x-4">
        <% if policy(comment).create? %>
          <button data-action="click->comments#toggle" class="hover:text-gray-800">Reply</button>
        <% end %>

        <% if policy(comment).update? %>
          <%= link_to "Edit", edit_article_comment_path(comment.article, comment),
                      data: { turbo_stream: true },
                      class: "hover:text-gray-800" %>
        <% end %>
        <% if policy(comment).destroy? %>
          <%= button_to "Delete", [comment.article, comment],
                        method: :delete,
                        data: { turbo_confirm: "Are you sure?" },
                        class: "text-red-500 hover:text-red-700" %>
        <% end %>

        <button id="reply-count-<%= comment.id %>"
                data-action="click->comments#toggleReplies"
                class="font-medium text-indigo-600 hover:underline <%= 'hidden' if comment.replies.empty? %>">
          <%= comment.replies.count == 1 ? "View 1 reply" : "View #{comment.replies.count} replies" %>
        </button>
      </div>

      <!-- Hidden Reply Form -->
      <div id="<%= dom_id(comment, :reply_form) %>"
           data-comments-target="replyForm"
           class="hidden mt-3 ml-12">
        <%= render 'comments/form',
                   article: comment.article,
                   comment: comment.replies.build %>
      </div>

      <!-- Replies -->
      <div id="<%= dom_id(comment, :replies) %>"
           data-comments-target="replies"
           class="hidden ml-12 mt-3 space-y-3 border-l pl-4">
        <% comment.replies.order(created_at: :asc).each do |reply| %>
          <%= render 'comments/comment', comment: reply %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
